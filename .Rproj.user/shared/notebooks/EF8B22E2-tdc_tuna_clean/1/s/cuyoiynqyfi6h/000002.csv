"0","# create a summary table of the top 2 most active flags"
"0","# useful for plotting"
"0","top_flag_s <- ll_aoi %>% "
"0","  filter(aoi == ""south"") %>% "
"0","  group_by(best_flag) %>% "
"0","  summarise(n_vessels = n_distinct(ssvid)) %>% "
"0","  mutate(prop = n_vessels/sum(n_vessels)) %>% "
"0","  top_n(2, wt = n_vessels) %>%"
"0","  arrange(desc(n_vessels))"
"0",""
"0","# create a barplot of number of vessels per year, coloured by vessel flag"
"0","# save as an object called p_fv_s"
"0","p_fv_s <- ll_vessels_flag_by_year %>% "
"0","  filter(aoi == ""south"") %>% "
"0","  # if the flag is not one of the top 5 most active flags, label it as ""other"""
"0","  mutate(flag_alt = if_else(best_flag %in% top_flag_s$best_flag, best_flag, ""other"") %>% "
"0","           factor(levels = c(top_flag_s$best_flag, ""other""))) %>% "
"0","  ggplot() +"
"0","  geom_col(aes(x = year, y = n_vessels, fill = flag_alt)) +"
"0","  scale_fill_manual(values = c(gfw_palette(""chart"")[c(1,3)],""grey50""),"
"0","                    name = ""Flag"") +"
"0","  scale_x_continuous(breaks = c(2016, 2017, 2018, 2019, 2020, 2021)) +"
"0","  labs(subtitle = ""South"","
"0","       x = ""Year"","
"0","       y = ""Active longliners"") + "
"0","  theme_gfw_cian() +"
"0","  theme(axis.title = element_text(size = 14),"
"0","        axis.text = element_text(size = 12),"
"0","        plot.subtitle = element_text(size = 14),"
"0","        legend.title = element_text(size = 16),"
"0","        legend.text = element_text(size = 14),"
"0","        strip.text = element_text(size = 16),"
"0","        legend.position = ""right"")"
