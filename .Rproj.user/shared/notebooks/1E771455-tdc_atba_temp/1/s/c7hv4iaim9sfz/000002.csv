"0","# summarise gap events per flag and vessel class"
"0","# arrange in descending order of number of gaps"
"0","# this allows us to arrange the vessel flags in the next plot by number of gap events"
"0","gap_summary <- gap_events %>% "
"0","  group_by(flag, vessel_class) %>% "
"0","  summarise(n_gaps = n_distinct(gap_id), "
"0","            gap_duration = mean(gap_hours)) %>% "
"0","  arrange(desc(n_gaps))"
"1","`summarise()` has grouped output by 'flag'. You can override using the `.groups` argument.
"
"0","# plot the number of gap events per flag as a bar plot"
"0","# colour each barplot by vessel category"
"0","gap_summary %>% "
"0","  mutate(flag = flag %>% "
"0","           factor(levels = distinct(gap_summary, flag) %>% "
"0","                    pull(flag)) %>% "
"0","                    recode_factor(""TWN"" = ""TPE"")) %>% "
"0","ggplot() +"
"0","    geom_col(aes(x = flag, y = n_gaps, fill = vessel_class)) +"
"0","    scale_fill_manual(values = gfw_palette(""chart"")[c(1,3,5)],"
"0","                      name = ""Vessel class"","
"0","                      labels = c(""Drifting longlines"", ""Set longlines"", ""Squid jigger"")) +"
"0","    labs(x = ""Flag"","
"0","         y = ""AIS gap events"","
"0","         title = ""AIS gap events near Tristan da Cunha"") +"
"0","    theme_gfw_cian() +"
"0","    theme(plot.title = element_text(size = 16),"
"0","          plot.subtitle = element_text(size = 14),"
"0","          axis.title = element_text(size = 14),"
"0","          axis.text = element_text(size = 12),"
"0","          legend.title = element_text(size = 14),"
"0","          legend.text = element_text(size = 12))"
