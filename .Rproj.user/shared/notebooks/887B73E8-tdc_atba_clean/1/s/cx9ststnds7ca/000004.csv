"0",""
"0","# summarise the number of transits per flag"
"0","flag_transit_summary <- vt_transits %>% "
"0","  filter(date >= ymd(""2020-04-01""),"
"0","         through_atba == TRUE,"
"0","         slowed_in_atba == FALSE,"
"0","         # exclude sailing vessels"
"0","         !ssvid %in% sailing_vessels$ssvid) %>% "
"0","  mutate(best_flag = best_flag %>% recode_factor(""TWN"" = ""TPE"")) %>% "
"0","  group_by(best_flag) %>% "
"0","  summarise(n_transits = n_distinct(transit_id_atba, na.rm = TRUE)) %>%"
"0","  # important for plotting - arrange in descending order by n_transits"
"0","  arrange(desc(n_transits))"
"0",""
"0","# plot the number of transits per flag"
"0","vt_transits %>% "
"0","  filter(date >= ymd(""2020-04-01""),"
"0","         through_atba == TRUE,"
"0","         slowed_in_atba == FALSE,"
"0","         !is.na(best_flag),"
"0","         # exclude sailing vessels"
"0","         !ssvid %in% sailing_vessels$ssvid) %>% "
"0","  group_by(best_flag) %>% "
"0","  summarise(n_transits = n_distinct(transit_id_atba)) %>% "
"0","  # reorder the factor levels of best_flag according to the number of transits per flag"
"0","  # useful for making a pretty plot"
"0","  mutate(best_flag = best_flag %>% "
"0","           recode_factor(""TWN"" = ""TPE"") %>% "
"0","           factor(levels = flag_transit_summary$best_flag)) %>% "
"0","  ggplot() +"
"0","    geom_col(aes(x = best_flag, y = n_transits), fill = gfw_palette(""chart"")[1]) +"
"0","    labs(x = ""Flag"", y = ""Transits through ATBA"","
"0","         title = ""Transits through ATBA by vessel flag"","
"0","         subtitle = ""April 1, 2020 to June 30, 2021"") +"
"0","    theme_gfw_cian() +"
"0","    theme(plot.title = element_text(size = 16),"
"0","          plot.subtitle = element_text(size = 14),"
"0","          axis.text = element_text(size = 12),"
"0","          axis.title = element_text(size = 14),"
"0","          legend.title = element_text(size = 14),"
"0","          legend.text = element_text(size = 12))"
