"0","# create a dataframe of the 10 flags that deployed the most sets in the region"
"0","# order these flags by the number of longline sets"
"0","# used to reorder the flags in the next plot"
"0","top_10_by_flag <- ll_ns %>% "
"0","  filter(!is.na(best_flag),"
"0","         start_lat <= -25) %>% "
"0","  group_by(best_flag) %>% "
"0","  summarise(n = n()) %>% "
"0","  top_n(10, wt = n) %>% "
"0","  arrange(desc(n))"
"0",""
"0","# plot longline sets per flag, coloured by time of setting (night or day)"
"0","ll_ns %>% "
"0","  # include only flags from top 10 and sets south of 25Â°S"
"0","  filter(best_flag %in% top_10_by_flag$best_flag, "
"0","         (start_lat <= -25 | end_lat <= -25)) %>% "
"0","  # reorder best_flag according to the order in top_10_by_flag "
"0","  mutate(best_flag = best_flag %>% "
"0","           factor(levels = top_10_by_flag[[""best_flag""]]) %>% "
"0","           recode_factor(""TWN"" = ""TPE"")) %>%"
"0","    ggplot() +"
"0","    geom_bar(aes(x = best_flag, fill = as.factor(cat3))) +"
"0","    scale_fill_discrete(type = rev(gfw_palette(""chart"")[c(1,7)]),"
"0","                        name = ""Time of setting"","
"0","                        labels = c(""Day"", ""Night"")) +"
"0","    labs(x = ""Flag"", "
"0","         y = ""Longline sets"","
"0","         title = ""Night setting by flag"","
"0","         subtitle = ""South Atlantic"") +"
"0","    theme_gfw_cian() +"
"0","    theme(plot.title = element_text(size = 16),"
"0","          plot.subtitle = element_text(size = 14),"
"0","          axis.text = element_text(size = 12),"
"0","          axis.title = element_text(size = 14),"
"0","          legend.title = element_text(size = 14),"
"0","          legend.text = element_text(size = 12),"
"0","          legend.position = ""bottom"")"
