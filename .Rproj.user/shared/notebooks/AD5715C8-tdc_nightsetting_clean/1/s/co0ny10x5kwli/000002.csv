"0","# create a dataframe of the 10 flags that deployed the most sets in the region"
"0","# order these flags by the number of longline sets"
"0","# used to reorder the flags in the next plot"
"0","top_aoi_by_flag <- ll_ns_tdc %>% "
"0","  filter(!is.na(best_flag)) %>% "
"0","  group_by(best_flag) %>% "
"0","  summarise(n = n(), "
"0","            prop = n/nrow(ll_ns_tdc),"
"0","            n_vessels = n_distinct(ssvid)) %>% "
"0","  arrange(desc(n))"
"0",""
"0","# plot longline sets per flag, coloured by time of setting (night or day)"
"0","ll_ns_tdc %>% "
"0","  mutate(month = lubridate::month(start_time),"
"0","         year = lubridate::year(start_time), "
"0","         best_flag = best_flag %>% factor(levels = top_aoi_by_flag[[""best_flag""]])) %>%"
"0","  filter(best_flag %in% c(""JPN"", ""KOR"")) %>%"
"0","    ggplot() +"
"0","    geom_bar(aes(x = best_flag, fill = as.factor(cat3))) +"
"0","    scale_fill_discrete(type = rev(gfw_palette(""chart"")[c(1,7)]),"
"0","                        name = ""Time of setting"","
"0","                        labels = c(""Day"", ""Night"")) +"
"0","    labs(x = ""Flag"", "
"0","         y = ""Longline sets"","
"0","         title = ""Night setting by flag"","
"0","         subtitle = ""Southeast Atlantic"") +"
"0","      theme_gfw_cian() +"
"0","    theme(plot.title = element_text(size = 16),"
"0","          plot.subtitle = element_text(size = 14),"
"0","          axis.text = element_text(size = 12),"
"0","          axis.title = element_text(size = 14),"
"0","          legend.title = element_text(size = 14),"
"0","          legend.text = element_text(size = 12),"
"0","          legend.position = ""right"")"
